---
title: "BaoHiem"
output:
  pdf_document:
    latex_engine: xelatex
---

\newpage
```{r include = TRUE, echo = TRUE, eval = TRUE}
insurance = read.csv(here("data", "insurance.csv"),  header=TRUE, sep=",")
names(insurance)
is.factor(insurance$smoker)
insurance$smoker = as.factor(insurance$smoker)
```
# BẢO HIỂM

**Mục tiêu**
chi phí bảo hiểm y tế có bị ảnh hưởng bởi người sử dụng bảo hiểm có hút thuốc hay không 

```{r include = TRUE, echo = TRUE, eval = TRUE}
insurance1 <- lm(charges ~ smoker, data = insurance, col = c(5,7)) 
plot(charges ~ smoker, data = insurance, col = c(5,7))

```
<br>- Từ biểu đồ boxplot, ta thấy rõ ràng việc sử dụng thuốc lá có ảnh hưởng rõ ràng đến số tiền họ chi tiêu cho bảo hiểm

```{r include = TRUE, echo = TRUE, eval = TRUE}
# aov() function:
insurance_aov = aov(charges ~ smoker, data = insurance)
insurance_aov
summary(insurance_aov)
```
- vì giá trị p-value < 0.05 => không đủ cơ sở bác bỏ giả thuyết là việc hút thuốc hay không sẽ không ảnh hưởng tới số tiền mua bảo hiểm.

```{r include = TRUE, echo = TRUE, eval = TRUE}
plot(insurance1,2) 
shapiro.test(residuals(insurance1))
```
**nhận xét**
- vì p < 0.05 -> ta không bác bỏ Giả thuyết không (H0) của kiểm định Shapiro-Wilk cho rằng dữ liệu có phân phối chuẩn.

```{r include = TRUE, echo = TRUE, eval = TRUE}
smoker = data.frame(smoker = unique(insurance$smoker))
data.frame(smoker, insurance = predict(insurance_aov, smoker))
```
**nhận xét**
- Người hút thuốc (smoker = yes) có chi phí bảo hiểm dự đoán cao hơn rất nhiều so với người không hút thuốc (smoker = no). Cụ thể, chi phí bảo hiểm dự đoán cho người hút thuốc là 32,050.232, trong khi đối với người không hút thuốc là 8,434.268.<br>
```{r include = TRUE, echo = TRUE, eval = TRUE}
#Post Hoc Testing
#test all possible comparisons of two means. 
with(insurance, pairwise.t.test(charges, smoker, p.adj = "none"))

#the Bonferroni correction
with(insurance, pairwise.t.test(charges, smoker, p.adj = "bonferroni"))


##Tukey’s Honest Significance difference 
TukeyHSD(insurance_aov, conf.level = 0.95)
# produce a plot of these confidence intervals
plot(TukeyHSD(insurance_aov, conf.level = 0.95))
```
<br>**nhận xét**
- Giá trị p < 2e-16 cho thấy rằng sự khác biệt về chi phí bảo hiểm giữa người hút thuốc (yes) và không hút thuốc (no) là rất có ý nghĩa thống kê. Cụ thể, xác suất để sự khác biệt này xảy ra do ngẫu nhiên là cực kỳ thấp.<br>